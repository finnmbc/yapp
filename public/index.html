<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Yapp</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 20px auto; }
    #timer { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
    #room { margin-bottom: 10px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; margin-bottom: 10px; }
    #rooms-overview { font-size: 14px; margin-bottom: 20px; }
  </style>
</head>
<body>
  <div id="timer">Neustart in: 120s</div>
  <div id="room">Du bist in: ...</div>
  <div id="rooms-overview"></div>

  <div id="chat"></div>
  <input id="msg" placeholder="Nachricht..." autocomplete="off" />
  <button onclick="sendMessage()">Senden</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const chat = document.getElementById('chat');
    const roomDisplay = document.getElementById('room');
    const timerDisplay = document.getElementById('timer');
    const roomsOverview = document.getElementById('rooms-overview');

    socket.on('joined_room', (roomId) => {
      roomDisplay.textContent = 'Du bist in: ' + roomId;
      appendMessage('--- Du bist jetzt in einem neuen Raum ---');
    });

    socket.on('message', (data) => {
      appendMessage(data.user + ': ' + data.text);
    });

    socket.on('rooms_update', (summary) => {
      roomsOverview.innerHTML = '<b>Aktuelle Räume:</b><br>' +
        summary.map(r => `${r.id}: ${r.count} Nutzer`).join('<br>');
    });

    function appendMessage(msg) {
      const div = document.createElement('div');
      div.textContent = msg;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('msg');
      const text = input.value.trim();
      if (text) {
        socket.emit('message', text);
        input.value = '';
      }
    }

    // Countdown-Timer für 2 Minuten
    let secondsLeft = 120;
    setInterval(() => {
      secondsLeft--;
      if (secondsLeft <= 0) secondsLeft = 120;
      timerDisplay.textContent = `Neustart in: ${secondsLeft}s`;
    }, 1000);
  </script>
</body>
</html>
